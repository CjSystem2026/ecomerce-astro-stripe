---
import { ClientRouter } from "astro:transitions";
import Footer from "@/components/Footer.astro";

interface Props {
  title?: string;
  description?: string;
  image?: string;
}

const {
  title = "Mi Tienda â€” Tu tienda online de confianza",
  description = "Encuentra los mejores productos al mejor precio. EnvÃ­os rÃ¡pidos y seguros.",
  image = "/og-image.jpg",
} = Astro.props;
---

<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    <meta name="robots" content="index, follow" />

    <!-- Open Graph -->
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={image} />
    <meta property="og:type" content="website" />

    <title>{title}</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <ClientRouter />
  </head>
  <body>
    <header class="site-header">
      <div class="container">
        <a href="/" class="logo">
          <span class="logo__icon">ğŸ›ï¸</span>
          <span class="logo__text">Mi<strong>Tienda</strong></span>
        </a>

        <nav class="nav" aria-label="NavegaciÃ³n principal">
          <a href="/" class="nav__link">Inicio</a>
          <a href="/productos" class="nav__link">Productos</a>
          <a href="/categorias" class="nav__link">CategorÃ­as</a>
        </nav>

        <form class="search-form" action="/productos" method="get">
          <div class="search-input-wrapper">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="search-icon"
            >
              <circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"
              ></path>
            </svg>
            <input
              type="search"
              name="search"
              placeholder="Buscar productos..."
              aria-label="Buscar"
              class="search-input"
            />
          </div>
        </form>

        <div class="header-actions">
          <a href="/carrito" class="cart-btn" aria-label="Ver carrito">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="22"
              height="22"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <circle cx="9" cy="21" r="1"></circle><circle
                cx="20"
                cy="21"
                r="1"></circle>
              <path
                d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"
              ></path>
            </svg>
            <span class="cart-btn__count" id="cart-count">0</span>
          </a>

          <button class="hamburger" id="menu-toggle" aria-label="Abrir menÃº">
            <span></span><span></span><span></span>
          </button>
        </div>
      </div>
    </header>

    <!-- Mobile nav -->
    <div class="mobile-nav" id="mobile-nav">
      <a href="/" class="mobile-nav__link">Inicio</a>
      <a href="/productos" class="mobile-nav__link">Productos</a>
      <a href="/categorias" class="mobile-nav__link">CategorÃ­as</a>
    </div>

    <main>
      <slot />
    </main>

    <Footer />

    <script>
      function initLayout() {
        // Cart counter from localStorage
        function updateCartCount() {
          const cart = JSON.parse(
            localStorage.getItem("cart") ?? "[]",
          ) as Array<unknown>;
          const countEl = document.getElementById("cart-count");
          if (countEl) countEl.textContent = String(cart.length);
        }

        // Mobile menu
        const menuToggle = document.getElementById("menu-toggle");
        const mobileNav = document.getElementById("mobile-nav");
        menuToggle?.addEventListener("click", () => {
          const isOpen = mobileNav?.classList.toggle("mobile-nav--open");
          menuToggle.classList.toggle("hamburger--open", isOpen);
        });

        // Add to cart
        document.addEventListener("click", (e) => {
          const btn = (e.target as HTMLElement).closest(".product-card__btn");
          if (!btn) return;
          const cart = JSON.parse(
            localStorage.getItem("cart") ?? "[]",
          ) as Array<Record<string, string>>;
          const id = btn.getAttribute("data-product-id")!;
          const existing = cart.find((i) => i.id === id);
          if (existing) {
            existing.qty = String(Number(existing.qty) + 1);
          } else {
            cart.push({
              id,
              name: btn.getAttribute("data-product-name") ?? "",
              price: btn.getAttribute("data-product-price") ?? "0",
              image: btn.getAttribute("data-product-image") ?? "",
              qty: "1",
            });
          }
          localStorage.setItem("cart", JSON.stringify(cart));
          updateCartCount();

          // Visual feedback
          const originalContent = btn.innerHTML;
          btn.textContent = "âœ“ AÃ±adido";
          setTimeout(() => {
            btn.innerHTML = originalContent;
          }, 1500);
        });

        updateCartCount();
      }

      // Initialize on first load and after navigations (View Transitions)
      document.addEventListener("astro:page-load", initLayout);
    </script>
  </body>
</html>

<style is:global>
  /* â”€â”€â”€ Design Tokens â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  :root {
    /* Colors */
    --primary: #7c3aed;
    --primary-dark: #6d28d9;
    --primary-light: #a78bfa;
    --accent: #f43f5e;
    --accent-dark: #e11d48;
    --success: #10b981;

    /* Backgrounds */
    --bg: #080812;
    --surface: #111128;
    --surface-2: #1a1a38;
    --surface-3: #22224a;
    --border: rgba(255, 255, 255, 0.07);
    --border-hover: rgba(124, 58, 237, 0.4);

    /* Text */
    --text: #f0f0fa;
    --text-muted: #7878a8;
    --text-subtle: #4a4a6a;

    /* Gradients */
    --gradient-primary: linear-gradient(135deg, #7c3aed, #f43f5e);
    --gradient-surface: linear-gradient(135deg, #111128, #1a1a38);
    --gradient-glow: radial-gradient(
      circle,
      rgba(124, 58, 237, 0.15) 0%,
      transparent 70%
    );

    /* Shadows */
    --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.3);
    --shadow-md: 0 8px 24px rgba(0, 0, 0, 0.4);
    --shadow-lg: 0 20px 60px rgba(0, 0, 0, 0.5);
    --shadow-glow: 0 0 40px rgba(124, 58, 237, 0.2);
    --shadow-card: 0 4px 20px rgba(0, 0, 0, 0.3);
    --shadow-card-hover: 0 16px 40px rgba(124, 58, 237, 0.25);

    /* Layout */
    --radius: 14px;
    --radius-lg: 20px;
    --radius-xl: 28px;
    --max-w: 1280px;

    /* Transitions */
    --transition: 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    --transition-slow: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }

  *,
  *::before,
  *::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }

  html {
    scroll-behavior: smooth;
  }

  body {
    font-family: "Inter", system-ui, sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }

  img {
    max-width: 100%;
    display: block;
  }
  a {
    color: inherit;
  }

  .container {
    width: 100%;
    max-width: var(--max-w);
    margin-inline: auto;
    padding-inline: 1.5rem;
  }

  /* â”€â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .site-header {
    position: sticky;
    top: 0;
    z-index: 100;
    background: rgba(15, 15, 23, 0.85);
    backdrop-filter: blur(12px);
    border-bottom: 1px solid var(--border);
  }

  .site-header .container {
    display: flex;
    align-items: center;
    gap: 2rem;
    height: 64px;
  }

  .logo {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    text-decoration: none;
    font-size: 1.2rem;
    color: var(--text);
  }

  .logo__icon {
    font-size: 1.5rem;
  }
  .logo__text strong {
    color: var(--primary);
  }

  .nav {
    display: flex;
    gap: 1.5rem;
    margin-left: auto;
  }

  .nav__link {
    text-decoration: none;
    color: var(--text-muted);
    font-size: 0.9rem;
    font-weight: 500;
    transition: color 0.2s;
  }

  .nav__link:hover {
    color: var(--text);
  }

  /* â”€â”€â”€ Search Bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .search-form {
    flex: 1;
    max-width: 400px;
    margin: 0 1rem;
  }

  .search-input-wrapper {
    position: relative;
    display: flex;
    align-items: center;
  }

  .search-icon {
    position: absolute;
    left: 12px;
    color: var(--text-muted);
    pointer-events: none;
  }

  .search-input {
    width: 100%;
    background: var(--surface-2);
    border: 1px solid var(--border);
    color: var(--text);
    padding: 8px 12px 8px 40px;
    border-radius: 10px;
    font-size: 0.9rem;
    transition: all 0.2s ease;
  }

  .search-input:focus {
    outline: none;
    border-color: var(--primary);
    background: var(--surface);
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.15);
  }

  .header-actions {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .cart-btn {
    position: relative;
    background: none;
    border: 1px solid var(--border);
    color: var(--text);
    border-radius: 10px;
    padding: 8px 12px;
    cursor: pointer;
    display: flex;
    align-items: center;
    transition:
      border-color 0.2s,
      background 0.2s;
  }

  .cart-btn:hover {
    background: var(--surface);
    border-color: var(--primary);
  }

  .cart-btn__count {
    position: absolute;
    top: -6px;
    right: -6px;
    background: var(--accent);
    color: white;
    font-size: 0.65rem;
    font-weight: 700;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    display: grid;
    place-items: center;
  }

  .hamburger {
    display: none;
    flex-direction: column;
    gap: 5px;
    background: none;
    border: none;
    cursor: pointer;
    padding: 4px;
  }

  .hamburger span {
    display: block;
    width: 22px;
    height: 2px;
    background: var(--text);
    border-radius: 2px;
    transition: all 0.3s ease;
  }

  .hamburger--open span:nth-child(1) {
    transform: translateY(7px) rotate(45deg);
  }
  .hamburger--open span:nth-child(2) {
    opacity: 0;
  }
  .hamburger--open span:nth-child(3) {
    transform: translateY(-7px) rotate(-45deg);
  }

  /* â”€â”€â”€ Mobile Nav â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .mobile-nav {
    display: none;
    flex-direction: column;
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    overflow: hidden;
    max-height: 0;
    transition: max-height 0.3s ease;
  }

  .mobile-nav--open {
    max-height: 300px;
  }

  .mobile-nav__link {
    padding: 1rem 1.5rem;
    text-decoration: none;
    color: var(--text-muted);
    border-bottom: 1px solid var(--border);
    font-weight: 500;
  }

  .mobile-nav__link:hover {
    color: var(--text);
    background: var(--surface-2);
  }

  /* â”€â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  @media (max-width: 768px) {
    .nav {
      display: none;
    }
    .hamburger {
      display: flex;
    }
    .mobile-nav {
      display: flex;
    }
  }

  /* â”€â”€â”€ Utilities â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .section {
    padding: 4rem 0;
  }
  .section-title {
    font-size: clamp(1.5rem, 3vw, 2rem);
    font-weight: 800;
    margin-bottom: 2rem;
  }

  .products-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
    gap: 1.5rem;
  }
</style>
