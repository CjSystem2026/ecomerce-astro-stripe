---
import MainLayout from "@/layouts/MainLayout.astro";
import ProductCard from "@/components/ProductCard.astro";
import Hero from "@/components/Hero.astro";
import TrustBar from "@/components/TrustBar.astro";
import CategoryBanner from "@/components/CategoryBanner.astro";
import WhatsAppBtn from "@/components/WhatsAppBtn.astro";

import { getFeaturedProducts, getCategories } from "@/lib/strapi";

const [products, categories] = await Promise.all([
  getFeaturedProducts(),
  getCategories(),
]);
---

<MainLayout
  title="MiTienda â€” Tu tienda online de confianza"
  description="Encuentra los mejores productos al mejor precio con envÃ­os rÃ¡pidos y seguros."
>
  <!-- 1. HERO â€” Captar atenciÃ³n -->
  <Hero />

  <!-- 2. TRUST BAR â€” Eliminar objeciones -->
  <TrustBar />

  <!-- 3. CATEGORÃAS â€” Orientar al usuario -->
  {
    categories.length > 0 && (
      <div class="container">
        <CategoryBanner categories={categories} />
      </div>
    )
  }

  <!-- 4. PRODUCTOS DESTACADOS â€” Crear deseo -->
  <section class="section" id="destacados">
    <div class="container">
      <div class="section-header">
        <div>
          <span class="section-eyebrow">SelecciÃ³n especial</span>
          <h2 class="section-title">Lo mÃ¡s destacado ðŸ”¥</h2>
        </div>
        <a href="/productos" class="link-ver-todos"> Ver todo el catÃ¡logo â†’ </a>
      </div>

      {
        products.length > 0 ? (
          <div class="products-grid">
            {products.map((product) => (
              <ProductCard product={product} />
            ))}
          </div>
        ) : (
          <div class="empty-state">
            <p>
              ðŸ›’ No hay productos destacados aÃºn. Marca algunos como "destacado"
              desde Strapi.
            </p>
          </div>
        )
      }
    </div>
  </section>

  <!-- 5. CTA BANNER â€” Empujar al catÃ¡logo completo -->
  <section class="cta-banner">
    <div class="container">
      <div class="cta-banner__content">
        <h2>Â¿No encontraste lo que buscabas?</h2>
        <p>
          Tenemos mÃ¡s de 20 productos esperÃ¡ndote en nuestro catÃ¡logo completo.
        </p>
        <a href="/productos" class="cta-banner__btn">
          Ver catÃ¡logo completo
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2.5"
            stroke-linecap="round"
            stroke-linejoin="round"
            ><path d="M5 12h14"></path><path d="m12 5 7 7-7 7"></path></svg
          >
        </a>
      </div>
    </div>
  </section>

  <!-- 6. BOTÃ“N WHATSAPP FLOTANTE -->
  <WhatsAppBtn />
</MainLayout>

<style>
  /* Section header con "Ver todos" */
  .section-header {
    display: flex;
    align-items: flex-end;
    justify-content: space-between;
    margin-bottom: 2rem;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .section-eyebrow {
    display: block;
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--primary-light);
    margin-bottom: 0.35rem;
  }

  .section-title {
    font-size: clamp(1.4rem, 3vw, 1.9rem);
    font-weight: 800;
    margin: 0;
  }

  .link-ver-todos {
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--primary-light);
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 0.3rem;
    white-space: nowrap;
    transition: opacity 0.2s;
    padding-bottom: 2px;
  }
  .link-ver-todos:hover {
    opacity: 0.7;
  }

  /* CTA Banner */
  .cta-banner {
    padding: 4rem 0;
  }

  .cta-banner__content {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius-xl);
    padding: 3rem 2.5rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    gap: 1rem;
    position: relative;
    overflow: hidden;
  }

  .cta-banner__content::before {
    content: "";
    position: absolute;
    inset: 0;
    background: radial-gradient(
      ellipse at center top,
      rgba(124, 58, 237, 0.12),
      transparent 60%
    );
    pointer-events: none;
  }

  .cta-banner__content h2 {
    font-size: clamp(1.4rem, 3vw, 2rem);
    font-weight: 800;
    color: var(--text);
    position: relative;
  }

  .cta-banner__content p {
    color: var(--text-muted);
    font-size: 1rem;
    max-width: 500px;
    position: relative;
  }

  .cta-banner__btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    background: linear-gradient(135deg, #7c3aed, #f43f5e);
    color: white;
    padding: 0.9rem 2rem;
    border-radius: var(--radius);
    font-weight: 700;
    font-size: 1rem;
    text-decoration: none;
    margin-top: 0.5rem;
    box-shadow: 0 8px 24px rgba(124, 58, 237, 0.35);
    transition: all 0.25s ease;
    position: relative;
  }

  .cta-banner__btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 32px rgba(124, 58, 237, 0.5);
  }

  /* Empty state */
  .empty-state {
    text-align: center;
    padding: 3rem 2rem;
    background: var(--surface);
    border: 1px dashed var(--border);
    border-radius: var(--radius-lg);
    color: var(--text-muted);
    font-size: 1rem;
  }
</style>
